## 第7章 性質串列

### 7.1 引言

    雖然我們強調基元和一般程式語言的變數並不相同，但到目前為止，我
們都把基元當成變數使用。基元有個特點，也就是具有性質（properties）。
讀者可以把基元的性質視為真實物體具有性質一般。例如，椅子會有顏色，
重量，高度等等。可能有張椅子，顏色是藍色，重40磅，並有3呎高。要
描述一個物體，則須有性質名稱（property name），例如顏色（color），
重量（weight）和高度（height）以及性質值（property value），例如藍
色（blue），40磅和3呎。
    LISP基元的性質，即根植於這種觀念。本章將說明LISP如何表達性
質這個概念，並介紹幾個性質運作函數，然後是幾個說明這些函數用法的程
式設計範例。最後，用性質來表達基元與其它程式語言的變數兩者間的差異
。

### 7.2 基本概論

    一個基元可以有任意數目的性質名稱，每個名稱可以有自己的值。函數
putprop可以把性質指定給基元。putprop接受3個引數，分別是基元，性
質值和性質名稱。這函數把基元的性質值更改成所指定的值。例如，要指出
chair3的顏色是藍色，可以這麼做：

    > (putprop 'chair3 'blue 'color)
    blue

putprop以性質值做為它的傳回值。
    函數defprop和putprop非常類似，但是它不對引數求值。所以

    > (defprop chair3 John owner)
    John

使得chair3的owner變成John （註-在某些LISP版本中，defprop
傳回第一個引數的值而非第二個引數的值。）。
    現在可以用函數get取出預先儲存的性質值了。get有兩個引數，求值
後必須產生基元和性質名稱。例如，要取出putprop和defprop儲存於
chair3的性質值，可以採取下列的做法：

    > (get 'chair3 'owner)
    John
    
    > (get 'chair3 'color)
    blue

LISP把基元所有的性質及對應的性質值放在性質串列（property list）內
，每個基元都有一個這種串列。讀者可以把這些性質串列視為簡單的資料庫
：putprop可把資料插入資料庫，get可以取出這些資料。
    當你在get中指定的性質並不存在時，get會傳回nil。但是get所取
的性質值若是nil，它也傳回nil，換句話說，get無法表示出這兩種nil
值的不同:

    > (defprop chair3 nil animate)
    nil

    > (get 'chair3 'animate)
    nil

    > (get 'chair3 'manufacturer)
    nil

我們先定義chair3的animate性質為nil。當我們要讀取這個值時，就得
到nil。但是當我們用get去讀取某個從未出現的性質時，也會得到相同的
答案nil。前者表示某個性質並未設定其值（在本例中，椅子（chair）不是
有生命（animate）的東西），後者則表示不知這個性質究竟代表何意（在
本例中，製造者（manufacturer）是什麼？）。對於程式設計師而言，如果
兩者的差異在程式中扮演極重要的角色，就必須小心的辨別這兩種狀況了。

### 7.3 實例

    > (defun add-book (bookref title author publisher)
	(putprop bookref title 'title)
	(putprop bookref author 'author)
	(putprop bookref publisher 'publisher)
	(setq Library (cons bookref Library))
	bookref)
    add-book

    > (setq Library nil)
    nil

    > (add-book 'book1
	    '(War and Peace)
	    '(Leo Tolstoy)
	    '(Frumpdeedump Press))
    book1

    > (add-book 'book2
	    '(Artificial Intelligence)
	    '(Patrick Winston)
	    '(Addison-Wesley))
    book2

    > (add-book 'book3
	    '(Data Structure Techniques)
	    '(Tim Standish)
	    '(Addison-Wesley))
    book3

    > Library
    (book1 book2 book3)

    > (defun retrieve-by (property value)
	(prog (l result)
	    (setq l Library)
	    loop
	    (cond [(null l) (return result)]
		  [(equal (get (car l) property) value)
		    (setq result (cons (car l) result))])
	    (setq l (cdr l))
	    (go loop)))
    retrieve-by

    > (retrieve-by 'author '(Leo Tolstoy))
    (book1)

    > (retrieve-by 'publisher '(Addison-Wesley))
    (book3 book2)

### 7.4 性質串列的重要性

### 7.5 性質串列以及基元的唯一性

    > (setq v 4)
    4

    > (defprop v black color)
    black

    > (prog (v) (setq v 9) (return v))
    9

    > v
    4

    > (prog (v) (defprop v red color) (return (get 'v 'color)))
    red

    > (get 'v 'color)
    ???

### 7.6 分離式性質串列

    > (get '(nil John Mercedes Bill Ford Mary Porsche) 'Bill)
    Ford

### 7.7 摘要